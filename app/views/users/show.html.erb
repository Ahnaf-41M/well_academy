<section style="background-color: #eee;">
  <div class="container py-5">
    <div class="row">
      <div class="col">
        <nav class="bg-body-tertiary rounded-3 p-3 mb-4 justify-content-right">
          <h2 class="fw-bold">User Profile</h2>
        </nav>
      </div>
    </div>

    <div class="row">
      <div class="col-lg-4">
        <div class="card mb-4">

          <div class="card-body text-center">
            <% if @user.profile_picture.attached? %>
              <img src="<%= url_for(@user.profile_picture) %>" alt="" style="width: 300px; height: 300px;" title="Profile picture">
              <%= button_to "Remove Picture", remove_profile_picture_user_path(@user), method: :post, class: "btn btn-outline-danger btn-sm mt-3", onclick: "return confirm('Are you sure?');" %>
            <% else %>
              <img src="<%= asset_path("no-image-available.jpg") %>" class="card-img-top" alt="" title="Profile picture">
              <%= form_with(model: @user, url: user_path(@user), class: "mx-1 mx-md-4", method: :patch) do |f| %>
                <%= f.file_field :profile_picture, accept: "image/*", class: "form-control mb-2" %>
                <div class="d-grid gap-2">
                  <%= f.submit "Upload", class: "btn btn-outline-success btn-sm", disable_with: 'Submiting...' %>
                </div>
              <% end %>
            <% end %>

            <h5 class="my-3"><%= @user.name.split.map(&:capitalize).join(' ') %></h5>
            <p class="text-muted mb-1"><%= @user.bio %></p>
          </div>
        </div>
      </div>

      <div class="col-lg-8">
        <div class="card mb-4">
          <div class="card-body">
            <div class="row">
              <div class="col-sm-3">
                <p class="mb-0">Full Name</p>
              </div>
              <div class="col-sm-9">
                <p class="text-muted mb-0"><%= @user.name.split.map(&:capitalize).join(' ') %></p>
              </div>
            </div>
            <hr>
            <div class="row">
              <div class="col-sm-3">
                <p class="mb-0">Email</p>
              </div>
              <div class="col-sm-9">
                <p class="text-muted mb-0"><%= @user.email %></p>
              </div>
            </div>
            <hr>
            <div class="row">
              <div class="col-sm-3">
                <p class="mb-0">Phone</p>
              </div>
              <div class="col-sm-9">
                <p class="text-muted mb-0"><%= @user.phone %></p>
              </div>
            </div>
            <hr>
            <div class="row">
              <div class="col-sm-3">
                <p class="mb-0">Role</p>
              </div>
              <div class="col-sm-9">
                <p class="text-muted mb-0">
                  <span class="badge rounded-pill text-bg-secondary"><%= @user.role.capitalize %></span>
                </p>
              </div>
            </div>
            <hr>
            <div class="row">
              <div class="col-sm-3">
                <p class="mb-0">Date Joined</p>
              </div>
              <div class="col-sm-9">
                <p class="text-muted mb-0">
                  <%= @user.date_joined.day.ordinalize + " " + @user.date_joined.strftime("%B, %Y") %>
                </p>
              </div>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6">
            <div class="card mb-4 mb-md-0">
              <div class="card-body">

                <p class="fw-bold h5 text-primary">Completion Certificates</p>
                <hr>
                <% @enrollments = Enrollment.where(student_id: @user.id) %>
                <% @enrollments.each do |enrollment| %>
                  <% @course = Course.find(enrollment.course_id) %>
                  <% if @user.video_watches.joins(:lesson).where(lessons: { course_id: @course.id }).count == @course.lessons.count %>
                    <%= link_to "#{@course.title}", url_for(@course.completion_certificate), class: "fw-bold text-dark", target: "_blank" %>
                    <hr>
                  <% end %>
                <% end %>
              </div>
            </div>
          </div>

          <div class="col-md-6">
            <div class="card mb-4 mb-md-0">
              <div class="card-body">

                <p class="fw-bold h5 text-primary">Achievement Certificates</p>
                <hr>
                <% @enrollments = Enrollment.where(student_id: @user.id) %>
                <% @enrollments.each do |enrollment| %>
                  <% @course = Course.find(enrollment.course_id) %>
                  <% if @user.video_watches.joins(:lesson).where(lessons: { course_id: @course.id }).count == @course.lessons.count %>
                    <%= link_to "#{@course.title}", url_for(@course.completion_certificate), class: "fw-bold text-dark", target: "_blank" %>
                    <hr>
                  <% end %>
                <% end %>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>
</section>